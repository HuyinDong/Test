<?php
$pagename='el';

require_once("./db.php");


$limit=$_GET['limits'];

if ($_REQUEST['stype'] == null)
	$stype = 'vuls' ;
else
{
	$stype = $_REQUEST['stype'] ;
    $_REQUEST[page] = 1 ;
}

if ($_REQUEST['dbtype'] == null)
	$dbtype = 'EDB' ;
else
	$dbtype = $_REQUEST['dbtype'] ;

if ($_REQUEST[page] == null)
        $_REQUEST[page] = 1 ;



if($_REQUEST)
{

		if ($dbtype == 'ALL' )
			$para = "   and  (  (title like \"%$_REQUEST[keywords]%\") or ( description like \"%$_REQUEST[keywords]%\" ) or ( ereferences like \"%$_REQUEST[keywords]%\" ) )";
		elseif ($dbtype == 'EDB' )
			$para = " and  source='exploit-db.com' and  (  (title like \"%$_REQUEST[keywords]%\") or ( description like \"%$_REQUEST[keywords]%\" ) or ( ereferences like \"%$_REQUEST[keywords]%\" ) )";
		elseif ($dbtype == 'PSS' )
			$para = " and  source='packetstormsecurity.com' and  (  (title like \"%$_REQUEST[keywords]%\") or ( description like \"%$_REQUEST[keywords]%\" ) or ( ereferences like \"%$_REQUEST[keywords]%\" ) )";
		elseif ($dbtype == 'RAP' )
			$para = " and  source='rapid7.com' and  (  (title like \"%$_REQUEST[keywords]%\") or ( description like \"%$_REQUEST[keywords]%\" ) or ( ereferences like \"%$_REQUEST[keywords]%\" ) )";
		elseif ($dbtype == 'EKU' )
			$para = " and  source='expku.com' and  (  (title like \"%$_REQUEST[keywords]%\") or ( description like \"%$_REQUEST[keywords]%\" ) or ( ereferences like \"%$_REQUEST[keywords]%\" ) )";
		elseif ($dbtype == 'SEF' )
			$para = " and  source='securityfocus.com' and  (  (title like \"%$_REQUEST[keywords]%\") or ( description like \"%$_REQUEST[keywords]%\" ) or ( ereferences like \"%$_REQUEST[keywords]%\" ) )";
}

$vul_sql = "select id, fid, title, published, description,ereferences,tags
			from  smartexploits
			where 1=1   $para
			order by fid desc
			limit $limit  " ;


$vul_results  = mysql_query($vul_sql) or die("Query failed: " . mysql_error());

$total_sql = "select count(id) from   smartexploits   where 1=1 $para " ;

$total_results  = mysql_query($total_sql) or die("Query failed: " . mysql_error());

$total_row = mysql_fetch_array($total_results) ;
$sig_total = $total_row[0];

$exploits = array();
if ($vul_results) {
    while ($row = mysql_fetch_object($vul_results)) $exploits[] = $row;
}
$data = array();

$data['aaData'] = $exploits;
$data['total'] = $sig_total;
echo json_encode($data);

?>
